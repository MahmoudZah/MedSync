<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shopping Cart - MedSync</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    .delivery-option {
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      background: white;
    }

    .delivery-option:hover {
      border-color: var(--primary-blue);
    }

    .delivery-option.active {
      border-color: var(--primary-blue);
      background: rgba(52, 152, 219, 0.05);
    }

    .delivery-option .option-icon {
      font-size: 1.5rem;
      color: var(--text-muted);
    }

    .delivery-option.active .option-icon {
      color: var(--primary-blue);
    }

    .delivery-fields {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .delivery-fields.show {
      display: block;
    }

    .pickup-info {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .pickup-info.show {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fee-badge {
      background: linear-gradient(135deg, var(--secondary-green), #27ae60);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .reserve-badge {
      background: linear-gradient(135deg, var(--primary-blue), #2980b9);
      color: white;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
      <a class="navbar-brand" href="index.html">
        <img src="assets/imgs/logo.jpg" alt="MedSync Logo" />
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item">
            <a class="nav-link" href="index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="marketplace.html">Find Medicine</a>
          </li>
          <li class="nav-item ms-lg-3">
            <a href="login.html" class="btn btn-outline-primary me-2">Log In</a>
            <a href="signup.html" class="btn btn-primary">Sign Up</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container py-5">
    <h2 class="mb-4">Shopping Cart</h2>
    <div class="row">
      <div class="col-lg-8">
        <!-- Cart Items -->
        <div class="card shadow-sm mb-4">
          <div class="card-body">
            <div id="cart-items">
              <!-- Cart items injected here -->
              <p class="text-center text-muted py-4">Your cart is empty.</p>
            </div>
          </div>
        </div>

        <!-- Delivery Options -->
        <div class="card shadow-sm mb-4" id="deliveryOptionsCard" style="display: none;">
          <div class="card-header bg-white">
            <h5 class="mb-0"><i class="bi bi-truck me-2"></i>Delivery Method</h5>
          </div>
          <div class="card-body">
            <div class="row g-3 mb-4">
              <div class="col-6">
                <div class="delivery-option active" id="deliveryOption" onclick="selectDeliveryMethod('delivery')">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-truck option-icon me-3"></i>
                    <div>
                      <h6 class="mb-0 fw-bold">Delivery</h6>
                      <small class="text-muted">To your address</small>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-6">
                <div class="delivery-option" id="pickupOption" onclick="selectDeliveryMethod('pickup')">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-shop option-icon me-3"></i>
                    <div>
                      <h6 class="mb-0 fw-bold">Pickup</h6>
                      <small class="text-muted">Reserve & collect</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Delivery Form -->
            <div class="delivery-fields show" id="deliveryFields">
              <h6 class="fw-bold mb-3"><i class="bi bi-geo-alt me-2"></i>Delivery Details</h6>
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <input type="tel" class="form-control" id="phoneNumber" placeholder="Phone Number" required>
                    <label for="phoneNumber">Phone Number</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <input type="text" class="form-control" id="streetAddress" placeholder="Street Address" required>
                    <label for="streetAddress">Street Address</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <select class="form-select" id="citySelect" onchange="updateDeliveryFee()">
                      <option value="" disabled selected>Select your city</option>
                      <option value="cairo" data-fee="20">Cairo - 20 EGP delivery</option>
                      <option value="giza" data-fee="20">Giza - 20 EGP delivery</option>
                      <option value="mansoura" data-fee="40">Mansoura - 40 EGP delivery</option>
                      <option value="alexandria" data-fee="50">Alexandria - 50 EGP delivery</option>
                    </select>
                    <label for="citySelect">City</label>
                  </div>
                </div>
              </div>
              <div class="alert alert-info mt-3 mb-0" id="deliveryFeeInfo" style="display: none;">
                <i class="bi bi-info-circle me-2"></i>
                <span id="deliveryFeeText">Delivery fee will be added based on your city.</span>
              </div>
            </div>

            <!-- Pickup Info -->
            <div class="pickup-info" id="pickupInfo">
              <div class="alert alert-warning mb-3">
                <h6 class="fw-bold mb-2"><i class="bi bi-info-circle me-2"></i>Reserve & Pickup</h6>
                <p class="mb-2">Pay a reservation fee online to hold your medicine for pickup:</p>
                <ul class="mb-0">
                  <li><strong>50 EGP reservation fee</strong> (or full price if medicine costs less than 50 EGP)</li>
                  <li>The reservation fee is <strong>deducted from the final price</strong> when you pick up</li>
                  <li>Pick up at the pharmacy within 24 hours</li>
                </ul>
              </div>
              <div class="bg-light p-3 rounded">
                <div class="d-flex justify-content-between align-items-center">
                  <span class="fw-bold">Online Payment Required:</span>
                  <span class="reserve-badge" id="reserveFeeDisplay">0 EGP</span>
                </div>
                <small class="text-muted d-block mt-2">Pay remaining balance at pickup</small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card shadow-sm sticky-top" style="top: 100px;">
          <div class="card-body">
            <h5 class="card-title mb-3">Order Summary</h5>
            <div class="d-flex justify-content-between mb-2">
              <span>Subtotal</span>
              <span id="cart-subtotal">0 EGP</span>
            </div>
            <div class="d-flex justify-content-between mb-2" id="deliveryFeeRow">
              <span>Delivery Fee</span>
              <span id="cart-delivery-fee">0 EGP</span>
            </div>
            <div class="d-flex justify-content-between mb-2" id="reserveFeeRow" style="display: none;">
              <span>Reservation Fee</span>
              <span id="cart-reserve-fee">0 EGP</span>
            </div>
            <hr />
            <div class="d-flex justify-content-between mb-2 fw-bold">
              <span id="totalLabel">Total</span>
              <span id="cart-total">0 EGP</span>
            </div>
            <div class="text-muted small mb-4" id="remainingPayment" style="display: none;">
              <i class="bi bi-wallet2 me-1"></i>
              Remaining to pay at pickup: <strong id="remainingAmount">0 EGP</strong>
            </div>
            <button class="btn btn-primary w-100" onclick="handleCheckout()" id="checkoutBtn">
              <span id="checkoutBtnText">Checkout</span>
            </button>
            <div class="text-danger small mt-2" id="checkoutError" style="display: none;"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css" />
  <script src="js/auth.js"></script>
  <script src="js/app.js"></script>
  <script src="js/cart.js"></script>
</body>

</html>